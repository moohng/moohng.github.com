---
title: 永久删除Git仓库中的大文件
date: 2017-09-07 15:04:50
tags:
- git
- 删除大文件
categories:
- 其他
---

有时候，手一抖就把一个*几十M甚至上百M的文件*提交到了`git`仓库中，这下整个人都不好了有木有。因为这个*大文件*直接是删不掉的，它会一直占用着你的项目空间大小，直到你实在受不了最后删库。以后每次首次拉取和推送项目的时候都是一个漫长的等待过程，我就是有过这样的经历才决定写这样的一篇文章，留着备用。

那么如何在不破坏`git`仓库的前提下完美删除*没用的大文件*？

### 一、找到项目中的大文件

```bash
# 查看项目空间占用情况（只是查看，可以不运行）
$ git count-objects -v
# 对文件进行排序，并列出前5大文件（根据自己的需求来）
$ git verify-pack -v .git/objects/pack/pack-*.idx | sort -k 3 -g | tail -5
```

如果运行报错，则先运行`git gc`命令，再运行上面的命令。成功之后会列出文件的`hash`值以及大小，然后根据`hash`值来确定文件的名称：

```bash
# 根据文件的hash值过滤
$ git rev-list --objects --all | grep 8f10e
```

### 二、删除找到的大文件

```bash
$ git filter-branch --index-filter 'git rm --cached --ignore-unmatch <your-file-name>'
```

之后复制以下的命令一步一步执行：

```bash
$ rm -rf .git/refs/original/

$ git reflog expire --expire=now --all

$ git fsck --full --unreachable

$ git repack -A -d

$ git gc --aggressive --prune=now
```

我也不知道每一条具体有什么用，反正一步一步执行就对了。

### 三、强制推送到远程仓库

```bash
$ git push --force [remote] [branch-name]
```

这下整个世界终于清静了！